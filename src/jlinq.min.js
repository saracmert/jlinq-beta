var jLinq,jlinq,jl;!function(){var c={command:{query:0,select:1,action:2},exp:{get_path:/\./g,escape_regex:/[\-\[\]\{\}\(\)\*\+\?\.\,\\\^\$\|\#\s]/g},type:{nothing:-1,undefined:0,string:1,number:2,array:3,regex:4,bool:5,method:6,datetime:7,object:99},library:{commands:{},types:{},addType:function(t,e){c.library.types[t]=e},extend:function(t){c.util.isType(c.type.array,t)||(t=[t]),c.util.each(t,function(t){c.library.commands[t.name]=t})},query:function(t,e){if(!c.util.isType(c.type.array,t))throw"jLinq can only query arrays of objects.";t=e.clone||null==e.clone&&jLinq.alwaysClone?c.util.clone(t):t;var u={instance:{ignoreCase:jLinq.ignoreCase,not:!1,lastCommand:null,lastField:null,records:t,removed:[],or:function(){u.startNewCommandSet()},query:{}},canRepeatCommand:function(t){return null!=u.instance.lastCommand&&t.length==u.instance.lastCommand.method.length+1&&c.util.isType(c.type.string,t[0])},commands:[[]],execute:function(){var e=[],n=u.instance;c.util.each(u.instance.records,function(t){n.record=t,u.evaluate(n)?e.push(t):u.instance.removed.push(t)}),u.instance.records=e},findValue:c.util.findValue,evaluate:function(t){for(var e=0,n=u.commands.length;e<n;e++){var r=u.commands[e];if(u.evaluateSet(r,t))return!0}return!1},evaluateSet:function(t,e){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e.value=u.findValue(e.record,r.path),e.compare=function(t){return c.util.compare(e.value,t,e)},e.when=function(t){return c.util.when(e.value,t,e)};try{var i=r.method.apply(e,r.args);if(r.not&&(i=!i),!i)return!1}catch(t){return!1}}return!0},repeat:function(arguments){u.instance.lastCommand&&null!=arguments&&(arguments=c.util.toArray(arguments),u.canRepeatCommand(arguments)&&(u.instance.lastField=arguments[0],arguments=c.util.select(arguments,null,1,null)),u.queue(u.instance.lastCommand,arguments))},queue:function(t,e){var n={name:(u.instance.lastCommand=t).name,method:t.method,field:u.instance.lastField,count:t.method.length,args:e,not:u.not};n.args.length>t.method.length&&(n.field=n.args[0],n.args=c.util.remaining(n.args,1),u.instance.lastField=n.field),n.path=n.field,u.commands[u.commands.length-1].push(n),u.not=!1},startNewCommandSet:function(){u.commands.push([])},setNot:function(){u.not=!u.not}};return c.util.each(c.library.commands,function(t){var e,n;t.type==c.command.query?(e=function(){return u.queue(t,arguments),u.instance.query},u.instance.query[t.name]=e,n=c.util.operatorName(t.name),u.instance.query["or"+n]=function(){return u.startNewCommandSet(),e.apply(null,arguments)},u.instance.query["orNot"+n]=function(){return u.startNewCommandSet(),u.setNot(),e.apply(null,arguments)},u.instance.query["and"+n]=function(){return e.apply(null,arguments)},u.instance.query["andNot"+n]=function(){return u.setNot(),e.apply(null,arguments)},u.instance.query["not"+n]=function(){return u.setNot(),e.apply(null,arguments)}):t.type==c.command.select?u.instance.query[t.name]=function(){u.execute();var n=u.instance;return n.compare=function(t,e){return c.util.compare(t,e,n)},n.when=function(t,e){return c.util.when(t,e,n)},t.method.apply(n,arguments)}:t.type==c.command.action&&(u.instance.query[t.name]=function(){var n=u.instance;return n.compare=function(t,e){return c.util.compare(t,e,n)},n.when=function(t,e){return c.util.when(t,e,n)},t.method.apply(n,arguments),u.instance.query})}),u.instance.query.or=function(){return u.startNewCommandSet(),u.repeat(arguments),u.instance.query},u.instance.query.and=function(){return u.repeat(arguments),u.instance.query},u.instance.query.not=function(){return u.setNot(),u.repeat(arguments),u.instance.query},u.instance.query.andNot=function(){return u.setNot(),u.repeat(arguments),u.instance.query},u.instance.query.orNot=function(){return u.startNewCommandSet(),u.setNot(),u.repeat(arguments),u.instance.query},u.instance.query}},util:{trim:function(t){return(t=(t=null==t?"":t).toString()).replace(/^\s*|\s*$/g,"")},cloneArray:function(t){var e=[];return c.util.each(t,function(t){e.push(c.util.clone(t))}),e},clone:function(t){if(c.util.isType(c.type.array,t))return c.util.cloneArray(t);if(c.util.isType(c.type.object,t)){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=c.util.clone(t[n]));return e}return t},invoke:function(t,e){var n=(e=e.concat())[0],r=c.util.findValue(t,n);e=c.util.select(e,null,1,null),n=n.replace(/\..*$/,"");var i=c.util.findValue(t,n);t=i===r?t:i;try{return r.apply(t,e)}catch(t){return null}},getPath:function(t){return c.util.toString(t).split(c.exp.get_path)},findValue:function(t,e){if(c.util.isType(c.type.array,e))return c.util.invoke(t,e);if(c.util.isType(c.type.string,e)){e=c.util.getPath(e);for(var n=0;null!=t&&n<e.length;)t=t[e[n++]];return t}return t},elementAt:function(t,e){return t&&0<t.length&&e<t.length&&0<=e?t[e]:null},regexEscape:function(t){return(t||"").toString().replace(c.exp.escape_regex,"\\$&")},regexMatch:function(t,e,n){return c.util.isType(c.type.regex,t)&&(t=t.source),t=new RegExp(c.util.toString(t),n?"gi":"g"),null!=c.util.toString(e).match(t)},operatorName:function(t){return t.replace(/^\w/,function(t){return t.toUpperCase()})},compare:function(t,e,n){var r=c.util.when(t,e,n);return 1==r&&r},when:function(t,e,n){var r=c.util.getType(t);for(var i in e){if(e.hasOwnProperty(i))if(c.type[i]==r)return e[i].apply(n,[t])}return e.other?e.other.apply(n,[t]):null},each:function(t,e){var n=0;for(var r in t)t.hasOwnProperty(r)&&e(t[r],n++)},grab:function(t,e){var n=[];return c.util.each(t,function(t){n.push(e(t))}),n},until:function(t,e){for(var n=0,r=t.length;n<r;n++){if(!0===e(t[n],n+1))return!0}return!1},isType:function(t,e){return c.util.getType(e)==t},getType:function(t){if(null==t)return c.type.nothing;for(var e in c.library.types)if(c.library.types[e](t))return e;return c.type.object},remaining:function(t,e){for(var n=[];e<t.length;e++)n.push(t[e]);return n},apply:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},reorder:function(t,e,n){return c.util._performSort(t,e,n)},_performSort:function(t,r,u){var a=r.splice(0,1);if(0==a.length)return t;a=a[0];var e=c.util.isType(c.type.array,a),o=(n=e?a[0]:a).match(/^\-/),n=o?n.substr(1):n;o&&(e?a[0]=n:a=n);var i,l;return t.sort(function(t,e){var n=c.util.findValue(t,a),r=c.util.findValue(e,a);null==n&&null==r?r=n=0:null==n&&null!=r?(n=0,r=1):null!=n&&null==r?(n=1,r=0):u&&c.util.isType(c.type.string,n)&&c.util.isType(c.type.string,r)?(n=n.toLowerCase(),r=r.toLowerCase()):n.length&&r.length&&(n=n.length,r=r.length);var i=n<r?-1:r<n?1:0;return o?-i:i}),0<r.length&&(i=[],l=c.util.group(t,a,u),c.util.each(l,function(t){var e=r.slice(),n=c.util._performSort(t,e,u);i=i.concat(n)}),t=i),t},group:function(t,e,n){for(var r={},i=0,u=t.length;i<u;i++){var a=t[i],o=c.util.toString(c.util.findValue(a,e));r[o=n?o.toUpperCase():o]?r[o].push(a):r[o]=[a]}return r},equals:function(t,e,n){return c.util.when(t,{string:function(){return c.util.regexMatch("^"+c.util.regexEscape(e)+"$",t,n)},other:function(){return null==t&&null==e||t===e}})},toArray:function(t){var e=[];if(t.length)for(var n=0;n<t.length;n++)e.push(t[n]);else for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return e},toString:function(t){return null==t?"":t.toString()},skipTake:function(t,e,n,r){return n=null==n?0:n,r=null==r?t.length:r,n>=t.length||0==r?[]:c.util.select(t,e,n,n+r)},select:function(t,e,n,r){n=null==n?0:n,r=null==r?t.length:r;var i,u=t.slice(n,r);if(jLinq.util.isType(jLinq.type.object,e)&&(i=e,e=function(t){var e={};for(var n in i)i.hasOwnProperty(n)&&(e[n]=t[n]?t[n]:i[n]);return e}),jLinq.util.isType(jLinq.type.method,e))for(var a=0;a<u.length;a++){var o=u[a];u[a]=e.apply(o,[o])}return u}}};c.library.addType(c.type.nothing,function(t){return null==t}),c.library.addType(c.type.array,function(t){return t instanceof Array}),c.library.addType(c.type.string,function(t){return t.substr&&t.toLowerCase}),c.library.addType(c.type.number,function(t){return t.toFixed&&t.toExponential}),c.library.addType(c.type.regex,function(t){return t instanceof RegExp}),c.library.addType(c.type.bool,function(t){return 1==t||0==t}),c.library.addType(c.type.method,function(t){return t instanceof Function}),c.library.addType(c.type.datetime,function(t){return t instanceof Date}),c.library.extend([{name:"ignoreCase",type:c.command.action,method:function(){this.ignoreCase=!0}},{name:"reverse",type:c.command.action,method:function(){this.records.reverse()}},{name:"useCase",type:c.command.action,method:function(){this.ignoreCase=!1}},{name:"each",type:c.command.action,method:function(e){jLinq.util.each(this.records,function(t){e(t)})}},{name:"attach",type:c.command.action,method:function(e,n){this.when(n,{method:function(){jLinq.util.each(this.records,function(t){t[e]=n(t)})},other:function(){jLinq.util.each(this.records,function(t){t[e]=n})}})}},{name:"join",type:c.command.action,method:function(e,n,r,i){jLinq.util.each(this.records,function(t){t[n]=jLinq.from(e).equals(i,t[r]).select()})}},{name:"assign",type:c.command.action,method:function(e,n,r,i,u){jLinq.util.each(this.records,function(t){t[n]=jLinq.from(e).equals(i,t[r]).first(u)})}},{name:"sort",type:c.command.action,method:function(){var t=jLinq.util.toArray(arguments);this.records=jLinq.util.reorder(this.records,t,this.ignoreCase)}},{name:"equals",type:c.command.query,method:function(t){return jLinq.util.equals(this.value,t,this.ignoreCase)}},{name:"starts",type:c.command.query,method:function(t){return this.compare({array:function(){return jLinq.util.equals(this.value[0],t,this.ignoreCase)},other:function(){return jLinq.util.regexMatch("^"+jLinq.util.regexEscape(t),this.value,this.ignoreCase)}})}},{name:"ends",type:c.command.query,method:function(t){return this.compare({array:function(){return jLinq.util.equals(this.value[this.value.length-1],t,this.ignoreCase)},other:function(){return jLinq.util.regexMatch(jLinq.util.regexEscape(t)+"$",this.value,this.ignoreCase)}})}},{name:"contains",type:c.command.query,method:function(n){return this.compare({array:function(){var e=this.ignoreCase;return jLinq.util.until(this.value,function(t){return jLinq.util.equals(t,n,e)})},other:function(){return jLinq.util.regexMatch(jLinq.util.regexEscape(n),this.value,this.ignoreCase)}})}},{name:"match",type:c.command.query,method:function(n){return this.compare({array:function(){var e=this.ignoreCase;return jLinq.util.until(this.value,function(t){return jLinq.util.regexMatch(n,t,e)})},other:function(){return jLinq.util.regexMatch(n,this.value,this.ignoreCase)}})}},{name:"type",type:c.command.query,method:function(t){return jLinq.util.isType(t,this.value)}},{name:"greater",type:c.command.query,method:function(t){return"[object Date]"===Object.prototype.toString.call(this.value)&&(t=new Date(this.value)),this.compare({array:function(){return this.value.length>t},string:function(){return this.value.length>t},other:function(){return this.value>t}})}},{name:"greaterEquals",type:c.command.query,method:function(t){return this.compare({array:function(){return this.value.length>=t},string:function(){return this.value.length>=t},other:function(){return this.value>=t}})}},{name:"less",type:c.command.query,method:function(t){return"[object Date]"===Object.prototype.toString.call(this.value)&&(t=new Date(this.value)),this.compare({array:function(){return this.value.length<t},string:function(){return this.value.length<t},other:function(){return this.value<t}})}},{name:"lessEquals",type:c.command.query,method:function(t){return this.compare({array:function(){return this.value.length<=t},string:function(){return this.value.length<=t},other:function(){return this.value<=t}})}},{name:"between",type:c.command.query,method:function(t,e){return this.compare({array:function(){return this.value.length>t&&this.value.length<e},string:function(){return this.value.length>t&&this.value.length<e},other:function(){return this.value>t&&this.value<e}})}},{name:"betweenEquals",type:c.command.query,method:function(t,e){return this.compare({array:function(){return this.value.length>=t&&this.value.length<=e},string:function(){return this.value.length>=t&&this.value.length<=e},other:function(){return this.value>=t&&this.value<=e}})}},{name:"empty",type:c.command.query,method:function(){return this.compare({array:function(){return 0==this.value.length},string:function(){return 0==jLinq.util.trim(this.value).length},other:function(){return null==this.value}})}},{name:"is",type:c.command.query,method:function(){return this.compare({bool:function(){return!0===this.value},other:function(){return null!=this.value}})}},{name:"min",type:c.command.select,method:function(t){var e=jLinq.util.reorder(this.records,[t],this.ignoreCase);return jLinq.util.elementAt(e,0)}},{name:"max",type:c.command.select,method:function(t){var e=jLinq.util.reorder(this.records,[t],this.ignoreCase);return jLinq.util.elementAt(e,e.length-1)}},{name:"sum",type:c.command.select,method:function(n){var r;return jLinq.util.each(this.records,function(t){var e=jLinq.util.findValue(t,n);r=null==r?e:r+e}),r}},{name:"average",type:c.command.select,method:function(n){var r;return jLinq.util.each(this.records,function(t){var e=jLinq.util.findValue(t,n);r=null==r?e:r+e}),r/this.records.length}},{name:"skip",type:c.command.select,method:function(t,e){return this.records=this.when(e,{method:function(){return jLinq.util.skipTake(this.records,e,t,null)},object:function(){return jLinq.util.skipTake(this.records,e,t,null)},other:function(){return jLinq.util.skipTake(this.records,null,t,null)}}),this.query}},{name:"take",type:c.command.select,method:function(t,e){return this.when(e,{method:function(){return jLinq.util.skipTake(this.records,e,null,t)},object:function(){return jLinq.util.skipTake(this.records,e,null,t)},other:function(){return jLinq.util.skipTake(this.records,null,null,t)}})}},{name:"skipTake",type:c.command.select,method:function(t,e,n){return this.when(n,{method:function(){return jLinq.util.skipTake(this.records,n,t,e)},object:function(){return jLinq.util.skipTake(this.records,n,t,e)},other:function(){return jLinq.util.skipTake(this.records,null,t,e)}})}},{name:"select",type:c.command.select,method:function(t){return this.when(t,{method:function(){return jLinq.util.select(this.records,t)},object:function(){return jLinq.util.select(this.records,t)},other:function(){return this.records}})}},{name:"distinct",type:c.command.select,method:function(e){var t=jLinq.util.group(this.records,e,this.ignoreCase);return jLinq.util.grab(t,function(t){return jLinq.util.findValue(t[0],e)})}},{name:"group",type:c.command.select,method:function(t){return jLinq.util.group(this.records,t,this.ignoreCase)}},{name:"define",type:c.command.select,method:function(t){var e=this.when(t,{method:function(){return jLinq.util.select(this.records,t)},object:function(){return jLinq.util.select(this.records,t)},other:function(){return this.records}});return jLinq.from(e)}},{name:"any",type:c.command.select,method:function(){return 0<this.records.length}},{name:"none",type:c.command.select,method:function(){return 0==this.records.length}},{name:"all",type:c.command.select,method:function(){return 0==this.removed.length}},{name:"first",type:c.command.select,method:function(t){var e=jLinq.util.elementAt(this.records,0);return null==e?t:e}},{name:"last",type:c.command.select,method:function(t){var e=jLinq.util.elementAt(this.records,this.records.length-1);return null==e?t:e}},{name:"at",type:c.command.select,method:function(t,e){var n=jLinq.util.elementAt(this.records,t);return null==n?e:n}},{name:"count",type:c.command.select,method:function(){return this.records.length}},{name:"removed",type:c.command.select,method:function(t){return this.when(t,{method:function(){return jLinq.util.select(this.removed,t)},object:function(){return jLinq.util.select(this.removed,t)},other:function(){return this.removed}})}},{name:"where",type:c.command.select,method:function(e){var n=this,r=[];jLinq.util.each(this.records,function(t){!0===e.apply(n,[t])&&r.push(t)});var t=jLinq.from(r);return this.ignoreCase||t.useCase(),t}}]),jLinq={alwaysClone:!1,ignoreCase:!0,command:c.command,type:c.type,extend:function(){c.library.extend.apply(null,arguments)},query:function(t,e){return library.framework.query(t,e)},from:function(t){return c.library.query(t,{clone:!1})},getCommands:function(){return c.util.grab(c.library.commands,function(t){return{name:t.name,typeId:t.type,type:t.type==c.command.select?"select":t.type==c.command.query?"query":t.type==c.command.action?"action":"unknown"}})},util:{trim:c.util.trim,findValue:c.util.findValue,elementAt:c.util.elementAt,regexEscape:c.util.regexEscape,regexMatch:c.util.regexMatch,equals:c.util.equals,group:c.util.group,reorder:c.util.reorder,when:c.util.when,toArray:c.util.toArray,each:c.util.each,grab:c.util.grab,until:c.util.until,isType:c.util.isType,getType:c.util.getType,apply:c.util.apply,select:c.util.select,skipTake:c.util.skipTake}},jl=jlinq=jLinq}();